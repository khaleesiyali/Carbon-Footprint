/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x372409,icons as _0x118845}from'ckeditor5/src/core.js';import{createDropdown as _0x2c7a0d,ButtonView as _0x4144d8,ListItemView as _0x2a3425,ListView as te,MenuBarMenuListItemButtonView as _0x3de888,MenuBarMenuListItemView as _0x3c4c8f,MenuBarMenuListView as _0x3fd598,MenuBarMenuView as _0x50052a}from'ckeditor5/src/ui.js';import _0x387f71 from'../../revisiontracker.js';import _0xa0555 from'./revisionhistorysaverevisionformview.js';import{getTranslation as _0x555c4a}from'../../utils/common-translations.js';export default class u extends _0x372409{static get['pluginName'](){return'RevisionHistoryUI';}static get['requires'](){return[_0x387f71];}['init'](){const _0x35a3fb=this['editor'],_0x199a63=_0x35a3fb['plugins']['get']('RevisionTracker');_0x35a3fb['ui']['componentFactory']['add']('revisionHistory',_0x2d2947=>{const _0x55808c=_0x2c7a0d(_0x2d2947),_0x14e423=_0x55808c['panelView']['children'],_0x2ddddc=new te(_0x2d2947),_0x12c9ec=new _0x2a3425(_0x2d2947),_0x3d90a5=new _0x4144d8(_0x2d2947),_0xe523ea=new _0x2a3425(_0x2d2947),_0x4934fa=new _0x4144d8(_0x2d2947);return _0x55808c['bind']('isEnabled')['to'](_0x199a63,'isReady',_0x199a63,'isEnabled',_0x35a3fb,'isReadOnly',(_0x19eca3,_0x38803a,_0x2ed2be)=>_0x19eca3&&_0x38803a&&!_0x2ed2be),_0x55808c['buttonView']['set']({'icon':_0x118845['history'],'label':_0x555c4a(_0x2d2947,'Revision\x20history'),'tooltip':!0x0}),_0x3d90a5['set']({'label':_0x555c4a(_0x2d2947,'Save\x20current\x20revision'),'withText':!0x0,'role':'menuitem'}),_0x3d90a5['bind']('isEnabled')['to'](_0x199a63,'isReady',_0x199a63,'isEnabled',_0x35a3fb,'isReadOnly',(_0x225bfa,_0x266740,_0x15b4c0)=>_0x225bfa&&_0x266740&&!_0x15b4c0),_0x3d90a5['on']('execute',()=>this['_showDialog']()),_0x4934fa['set']({'label':_0x555c4a(_0x2d2947,'Open\x20revision\x20history'),'withText':!0x0,'role':'menuitem'}),_0x4934fa['bind']('isEnabled')['to'](_0x199a63,'isReady',_0x35a3fb,'isReadOnly',(_0x3c8bbd,_0x103716)=>_0x3c8bbd&&!_0x103716),_0x4934fa['on']('execute',()=>{_0x35a3fb['config']['get']('revisionHistory')['showRevisionViewerCallback'](),_0x55808c['isOpen']=!0x1,_0x35a3fb['editing']['view']['focus']();}),_0x12c9ec['children']['add'](_0x3d90a5),_0xe523ea['children']['add'](_0x4934fa),_0x2ddddc['role']='menu',_0x2ddddc['items']['addMany']([_0x12c9ec,_0xe523ea]),_0x14e423['add'](_0x2ddddc),_0x55808c;}),_0x35a3fb['ui']['componentFactory']['add']('menuBar:revisionHistory',()=>this['_registerMenuComponent']());}['_registerMenuComponent'](){const _0xada6ed=this['editor'],_0x29276d=_0xada6ed['locale'],_0x36ab25=new _0x50052a(_0x29276d),_0x16e265=new _0x3fd598(_0x29276d);_0x36ab25['buttonView']['set']({'icon':_0x118845['history'],'label':_0x555c4a(_0x29276d,'Revision\x20history')});const _0x32de5e=new _0x3c4c8f(_0x29276d,_0x36ab25),_0x4b6c19=new _0x3de888(_0x29276d);_0x4b6c19['set']({'label':_0x555c4a(_0x29276d,'Save\x20current\x20revision')}),_0x4b6c19['delegate']('execute')['to'](_0x36ab25),_0x4b6c19['on']('execute',()=>{this['_showDialog']();}),_0x32de5e['children']['add'](_0x4b6c19),_0x16e265['items']['add'](_0x32de5e);const _0x35c4ac=new _0x3c4c8f(_0x29276d,_0x36ab25),_0x4e1cbb=new _0x3de888(_0x29276d);return _0x4e1cbb['set']({'label':_0x555c4a(_0x29276d,'Open\x20revision\x20history')}),_0x4e1cbb['delegate']('execute')['to'](_0x36ab25),_0x4e1cbb['on']('execute',()=>{_0xada6ed['config']['get']('revisionHistory')['showRevisionViewerCallback']();}),_0x35c4ac['children']['add'](_0x4e1cbb),_0x16e265['items']['add'](_0x35c4ac),_0x36ab25['panelView']['children']['add'](_0x16e265),_0x36ab25;}['_showDialog'](){const _0x529577=this['editor'],_0x393f35=_0x529577['locale'],t=_0x393f35['t'],_0x566326=_0x529577['plugins']['get']('Dialog'),_0x1ae791=_0x529577['plugins']['get']('RevisionTracker');function _0x21214b(_0x55c625){_0x529577['config']['get']('revisionHistory.requireRevisionName')&&''===_0x55c625['revisionName']?_0x55c625['revisionNameInputView']['errorText']=_0x555c4a(_0x393f35,'The\x20revision\x20name\x20cannot\x20be\x20empty.'):(_0x529577['plugins']['get'](_0x387f71)['saveRevision']({'name':_0x55c625['revisionName']}),_0x566326['hide']());}this['_saveRevisionFormView']||(this['_createSaveRevisionFormView'](),this['_saveRevisionFormView']['on']('submit',()=>_0x21214b(this['_saveRevisionFormView']))),this['_saveRevisionFormView']['reset'](),_0x566326['show']({'id':'revisionSave','title':_0x555c4a(_0x393f35,'Save\x20current\x20revision'),'isModal':!0x0,'content':this['_saveRevisionFormView'],'actionButtons':[{'label':t('Cancel'),'withText':!0x0,'onExecute':()=>_0x566326['hide']()},{'label':t('Accept'),'class':'ck-button-action','withText':!0x0,'onCreate'(_0x2affe4){_0x2affe4['bind']('isEnabled')['to'](_0x1ae791,'isReady',_0x1ae791,'isEnabled',_0x529577,'isReadOnly',(_0x323780,_0x3712ed,_0x141cb7)=>_0x323780&&_0x3712ed&&!_0x141cb7);},'onExecute':()=>_0x21214b(this['_saveRevisionFormView'])}]});}['_createSaveRevisionFormView'](){const _0x8078d7=this['editor'],_0xd96379=_0x8078d7['locale'];this['_saveRevisionFormView']=new _0xa0555(_0xd96379,_0x8078d7['config']['get']('revisionHistory.requireRevisionName')),this['_saveRevisionFormView']['render']();}}