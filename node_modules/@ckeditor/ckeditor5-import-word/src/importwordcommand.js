/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Command as _0x2e7b8e}from'ckeditor5/src/core.js';import{Range as _0x4cecfe}from'ckeditor5/src/engine.js';import{logWarning as _0x55743c,logError as _0x52c820,first as _0x6e2b17,uid as _0x222072}from'ckeditor5/src/utils.js';export default class d extends _0x2e7b8e{constructor(_0x2d63d1){super(_0x2d63d1),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x27fee0,_0x3d3115)=>{const _0x25a60b=new DataTransfer();_0x25a60b['setData']('text/html',_0x3d3115['html']);const _0x59027c=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x25eea0=>{this['_importMarker']['stopListening'](),_0x25eea0['setSelection'](_0x59027c),_0x2d63d1['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x25a60b});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x57d1ea,_0x4f57d2={}){if(this['isBusy'])return Promise['resolve']();const _0x4c4470=this['editor']['config']['get']('importWord'),_0x14076c={'url':_0x4c4470['converterUrl'],'file':_0x57d1ea,'serviceConfig':{..._0x4f57d2,'formatting':_0x4c4470['formatting']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x14076c)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0x3093a6=this['editor']['model'],_0x54bdee=_0x3093a6['schema'],_0x4e7247=_0x3093a6['document']['selection'],_0x4353a1=_0x6e2b17(_0x4e7247['getSelectedBlocks']());return!!_0x4353a1&&_0x54bdee['checkChild'](_0x4353a1['parent'],'paragraph');}['_prepareForImport'](){const _0x518357=this['editor'],_0x433a54=_0x518357['model'],_0x10c08a=_0x433a54['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0x518357['model']['createBatch']({'isUndoable':!0x0}),_0x433a54['enqueueChange'](this['_undoStepBatch'],_0x1cab23=>{_0x10c08a['isCollapsed']||_0x433a54['deleteContent'](_0x10c08a,{'leaveUnmerged':!0x0});const _0x182a69=_0x10c08a['getFirstPosition'](),_0x2f6465=_0x6e2b17(_0x10c08a['getSelectedBlocks']());let _0x2457ec;_0x2457ec=_0x2f6465['is']('element','paragraph')&&_0x2f6465['isEmpty']?_0x182a69:_0x182a69['isAtStart']?_0x433a54['createPositionBefore'](_0x2f6465):_0x182a69['isAtEnd']?_0x433a54['createPositionAfter'](_0x2f6465):_0x1cab23['split'](_0x182a69)['position'],this['_importMarker']=_0x1cab23['addMarker']('importWord:'+_0x222072(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x4cecfe(_0x2457ec)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x550454=this['editor']['model'];_0x550454['markers']['has'](this['_importMarker'])&&_0x550454['enqueueChange'](this['_undoStepBatch'],_0x1f4fee=>{_0x1f4fee['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x4ba20e,file:_0x153bf3,serviceConfig:_0x4af2b0}){const _0x28247a=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x256fc7=new FormData();_0x256fc7['set']('config',JSON['stringify'](_0x4af2b0)),_0x256fc7['set']('file',_0x153bf3);const _0x1d13b2={'method':'POST','headers':{},'body':_0x256fc7,'signal':this['_abortController']['signal']};return _0x28247a&&(_0x1d13b2['headers']['Authorization']=_0x28247a['value']),fetch(_0x4ba20e,_0x1d13b2);}['_handleImportResponse'](_0x39dd67){return _0x39dd67['ok']?_0x39dd67['json']()['then'](_0x3610aa=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x3610aa);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x55743c('import-word-plugin-import-cancelled');const _0x44b10e=this['editor'],_0x53cee7=(0x0,_0x44b10e['t'])('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x44b10e['plugins']['get']('Notification')['showWarning'](_0x53cee7),_0x52c820('import-word-plugin-conversion-failed');}}