/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x289c85 from'./../messagescompressor.js';import _0x3b4d18 from'./messages/addcommentmessage.js';import _0x1df398 from'./responses/addcommentresponse.js';import _0x5a520f from'./messages/connectmessage.js';import _0x1d6738 from'./responses/connectresponse.js';import _0x28fb54 from'./messages/removecommentmessage.js';import _0x29a6b7 from'./messages/removecommentthreadmessage.js';import _0x155121 from'./messages/updatecommentmessage.js';import _0x440c80 from'./messages/getcommentthreadmessage.js';import _0xac2eb2 from'./responses/getcommentthreadresponse.js';import _0x35accf from'./messages/getdocumentthreadsmessage.js';import _0x1f1802 from'./responses/getdocumentthreadsresponse.js';import _0x16cde5,{WEB_SOCKET_GATEWAY_STATES}from'./../websocketgateway/websocketgateway.js';import _0x42d00a from'./../ckeditorcloudserviceserror.js';import _0xb8e22c from'../sessions/sessions.js';import _0x4c427c from'../errors/ServiceNotConnectedError.js';import _0x531a8d from'../ckeditorcloudservicesservererror.js';import _0x2e62bd from'./responses/comment-threads/addcommentthreadresponse.js';import _0x1e4de4 from'./messages/comment-threads/addcommentthreadmessage.js';import _0x42d176 from'./messages/comment-threads/resolvecommentthreadmessage.js';import _0x173571 from'./messages/comment-threads/reopencommentthreadmessage.js';import _0x35846e from'./messages/comment-threads/updatecommentthreadmessage.js';import _0x4ca046 from'./responses/comment-threads/resolvecommentthreadresponse.js';export const _SERVICE=0x9;class CommentsService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0x1e8f81){super(),this['_documentId']=_0x1e8f81,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x14218c){if(this['_isConnected'])return;if(_0x14218c['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x42d00a('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x14218c);const _0x9d8689=new _0x5a520f(this['_documentId']);this['_wsGateway']=_0x14218c,this['stopListening'](_0x14218c,'change:state');const _0x22db33=await _0x14218c['_sendRequest'](0x9,_0x5a520f['TYPE'],_0x289c85['encode'](_0x9d8689)),{channel:_0x103ac4,threads:_0xf05516}=_0x289c85['decode'](_0x22db33,_0x1d6738);return this['listenTo'](_0x14218c,'change:state',(_0x42c1a9,_0x5d1636,_0x99018a)=>this['_onWsGatewayStateChange'](_0x99018a),{'priority':_0x16cde5['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x14218c,_0x103ac4),this['_isConnected']=!0x0,this['fire']('connected'),_0xf05516;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x2352b0,_0x280eff,_0x5c3d78,_0x4fa6d7){const _0x354714=new _0x3b4d18(this['_documentId'],_0x2352b0,_0x5c3d78,_0x280eff,void 0x0,void 0x0,_0x4fa6d7),_0x43b564=await this['_sendRequest'](_0x3b4d18['TYPE'],_0x354714);return _0x289c85['decode'](_0x43b564,_0x1df398);}async['updateComment'](_0x4ff297,_0xd4b77e,_0x1f3bfb,_0x4bf89e){const _0x3b266c=void 0x0!==_0x4bf89e,_0x3be91a=new _0x155121(this['_documentId'],_0x4ff297,_0xd4b77e,_0x1f3bfb,_0x4bf89e,_0x3b266c);await this['_sendRequest'](_0x155121['TYPE'],_0x3be91a);}async['removeComment'](_0x2ded17,_0x5e3c34){const _0x412db9=new _0x28fb54(this['_documentId'],_0x2ded17,_0x5e3c34);await this['_sendRequest'](_0x28fb54['TYPE'],_0x412db9);}async['removeCommentThread'](_0x2cbf41){const _0xb9abf5=new _0x29a6b7(this['_documentId'],_0x2cbf41);await this['_sendRequest'](_0x29a6b7['TYPE'],_0xb9abf5);}async['addCommentThread'](_0x450c0c){var _0x3224db;const _0xc56fbf=new _0x1e4de4(this['_documentId'],_0x450c0c['commentThreadId'],null===(_0x3224db=_0x450c0c['comments'])||void 0x0===_0x3224db?void 0x0:_0x3224db['map'](_0x499cb8=>({..._0x499cb8,'documentId':this['_documentId'],'commentThreadId':_0x450c0c['commentThreadId']})),_0x450c0c['context'],_0x450c0c['resolvedBy'],_0x450c0c['createdAt'],_0x450c0c['resolvedAt'],_0x450c0c['deletedAt'],_0x450c0c['attributes']),_0x3cab17=await this['_sendRequest'](_0x1e4de4['TYPE'],_0xc56fbf);return _0x289c85['decode'](_0x3cab17,_0x2e62bd);}async['resolveCommentThread'](_0x14d627){const _0x3de460=new _0x42d176(_0x14d627,this['_documentId']),_0x1db05d=await this['_sendRequest'](_0x42d176['TYPE'],_0x3de460);return _0x289c85['decode'](_0x1db05d,_0x4ca046);}async['reopenCommentThread'](_0x561a59){const _0x19759a=new _0x173571(_0x561a59,this['_documentId']);await this['_sendRequest'](_0x173571['TYPE'],_0x19759a);}async['updateCommentThread'](_0x344e3a){const _0x3dfa35=new _0x35846e(_0x344e3a['commentThreadId'],this['_documentId'],_0x344e3a['context'],_0x344e3a['attributes'],_0x344e3a['unlinkedAt']);await this['_sendRequest'](_0x35846e['TYPE'],_0x3dfa35);}async['getCommentThread'](_0xa41839,_0x45d20b=0x1){const _0x59c134=new _0x440c80(_0xa41839,this['_documentId']);try{const _0x94b4e8=await this['_sendRequest'](_0x440c80['TYPE'],_0x59c134),_0xf7e677=_0x289c85['decode'](_0x94b4e8,_0xac2eb2);return{'commentThreadId':_0xf7e677['commentThreadId'],'comments':_0xf7e677['comments'],'attributes':_0xf7e677['attributes'],'context':_0xf7e677['context'],'resolvedAt':_0xf7e677['resolvedAt'],'resolvedBy':_0xf7e677['resolvedBy'],'deletedAt':_0xf7e677['deletedAt'],'unlinkedAt':_0xf7e677['unlinkedAt']};}catch(_0x72992e){if('CKEditorCloudServicesServerError'===_0x72992e['name']&&'404'===_0x72992e['code']&&_0x45d20b<0x5)return await(_0x21d800=0x64*_0x45d20b,new Promise(_0x242e10=>{setTimeout(_0x242e10,_0x21d800);})),this['getCommentThread'](_0xa41839,_0x45d20b+0x1);if('CKEditorCloudServicesServerError'===_0x72992e['name'])throw _0x72992e;throw _0x531a8d['fromPublicError'](_0x72992e);}var _0x21d800;}async['getDocumentThreads'](){const _0x194b4a=new _0x35accf(this['_documentId']),_0x3ae38a=await this['_sendRequest'](_0x35accf['TYPE'],_0x194b4a),{threads:_0x164545}=_0x289c85['decode'](_0x3ae38a,_0x1f1802);return{'threads':_0x164545};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new _0x4c427c('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await _0xb8e22c['getConnectedSessions'](this['_wsGateway'],this['_documentId'],0x9)),this['_connectedSessions'];}['_connectToChannel'](_0x122bda,_0x3dd018){this['_channel']=_0x122bda['_getChannel'](CommentsService['_SERVICE'],_0x3dd018),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3b4d18['TYPE']),(_0x38c51d,_0x2d05f6)=>{const _0x40b22a=_0x289c85['decode'](_0x2d05f6,_0x3b4d18);this['fire']('commentAdded',_0x40b22a);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x28fb54['TYPE']),(_0x179b03,_0x90db10)=>{const _0x4cf11f=_0x289c85['decode'](_0x90db10,_0x28fb54);this['fire']('commentRemoved',_0x4cf11f);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x155121['TYPE']),(_0xd4ee93,_0x1537eb)=>{const _0x47debf=_0x289c85['decode'](_0x1537eb,_0x155121);this['fire']('commentUpdated',_0x47debf);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x29a6b7['TYPE']),(_0x4f0906,_0x117ba0)=>{const _0x51db11=_0x289c85['decode'](_0x117ba0,_0x29a6b7);this['fire']('commentThreadRemoved',_0x51db11);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x1e4de4['TYPE']),(_0x4d6e88,_0x3ecbb3)=>{const _0x20c21b=_0x289c85['decode'](_0x3ecbb3,_0x1e4de4);this['fire']('commentThreadAdded',_0x20c21b);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x35846e['TYPE']),(_0x36e3a6,_0x221067)=>{const _0x4e9666=_0x289c85['decode'](_0x221067,_0x35846e);this['fire']('commentThreadUpdated',_0x4e9666);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x42d176['TYPE']),(_0x4507d7,_0x3f26d5)=>{const _0x59cfd0=_0x289c85['decode'](_0x3f26d5,_0x42d176);this['fire']('commentThreadResolved',_0x59cfd0);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x173571['TYPE']),(_0x40e07e,_0x153772)=>{const _0x40b0f1=_0x289c85['decode'](_0x153772,_0x173571);this['fire']('commentThreadReopened',_0x40b0f1);}));}['_onWsGatewayStateChange'](_0x152c26){_0x152c26===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x5081e4,_0x5e3a38){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x4c427c('Comments',this);return this['_wsGateway']['_sendRequest'](0x9,_0x5081e4,_0x289c85['encode'](_0x5e3a38));}}CommentsService['_SERVICE']=0x9;export default CommentsService;