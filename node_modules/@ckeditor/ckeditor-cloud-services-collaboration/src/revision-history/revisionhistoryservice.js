/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x41a926 from'./../messagescompressor.js';import _0x4938ae from'./messages/revisionhistorygetrevisionmessage.js';import _0x58744a from'./responses/revisionhistorygetrevisionresponse.js';import _0x3af0b7 from'./messages/revisionhistoryupdaterevisionsmessage.js';import _0x6a198e from'./responses/revisionhistoryupdaterevisionsresponse.js';import _0x3b228f from'./messages/revisionhistoryconnectmessage.js';import _0x3b8a5b from'./responses/revisionhistoryconnectresponse.js';import _0x518fa7 from'./messages/revisionhistoryreconnectmessage.js';import _0x43a0d1 from'../ckeditorcloudserviceserror.js';import _0x433a04,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x3c2363 from'../errors/ServiceNotConnectedError.js';export const _SERVICE=0xc;class RevisionHistoryService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0x3349fc){super(),this['_documentId']=_0x3349fc,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x5db1dd){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x5db1dd,new _0x3b228f(this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0xc1ab75,_0x107e78){if(this['isConnected'])throw new _0x43a0d1('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0xc1ab75);return this['_connect'](_0xc1ab75,new _0x518fa7(this['_documentId'],_0x107e78));}async['updateRevisions'](_0x2c5564,_0x5bd34b){const _0x4f733f=_0x3af0b7['create']({'documentId':this['_documentId'],'requestId':_0x5bd34b,'revisions':_0x2c5564}),_0x41bc7e=await this['_sendRequest'](_0x3af0b7['TYPE'],_0x4f733f),{requestId:_0x54c639}=_0x41a926['decode'](_0x41bc7e,_0x6a198e);return _0x54c639;}async['getRevision'](_0x728b5e){const _0x50c0cc=new _0x4938ae(this['_documentId'],_0x728b5e),_0x280d8b=await this['_sendRequest'](_0x4938ae['TYPE'],_0x50c0cc);return _0x41a926['decode'](_0x280d8b,_0x58744a)['toObject']();}async['_connect'](_0x2bb4cd,_0x2fe801){if(_0x2bb4cd['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x43a0d1('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x2bb4cd);this['_wsGateway']=_0x2bb4cd,this['stopListening'](_0x2bb4cd,'change:state');const _0x20232e=await _0x2bb4cd['_sendRequest'](0xc,_0x2fe801['constructor']['TYPE'],_0x41a926['encode'](_0x2fe801)),{channel:_0x5cd499,requestId:_0x281e5b,revisions:_0x4f0fa7}=_0x41a926['decode'](_0x20232e,_0x3b8a5b)['toObject']();return this['listenTo'](_0x2bb4cd,'change:state',(_0x33511b,_0x23e00e,_0x5d5344)=>this['_onWsGatewayStateChange'](_0x5d5344),{'priority':_0x433a04['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x2bb4cd,_0x5cd499),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':_0x4f0fa7,'requestId':_0x281e5b};}['_connectToChannel'](_0x82551f,_0x400feb){this['_channel']=_0x82551f['_getChannel'](RevisionHistoryService['_SERVICE'],_0x400feb),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3af0b7['TYPE']),(_0x576c82,_0x9ce0c3)=>{const {documentId:_0xe40dec,requestId:_0x10e28e,revisions:_0x1529a6}=_0x41a926['decode'](_0x9ce0c3,_0x3af0b7)['toObject']();this['fire']('revisionsUpdated',{'documentId':_0xe40dec,'requestId':_0x10e28e,'revisionsData':_0x1529a6});});}['_onWsGatewayStateChange'](_0x2d130a){_0x2d130a===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x525484,_0x267465){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x3c2363('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](0xc,_0x525484,_0x41a926['encode'](_0x267465));}}RevisionHistoryService['_SERVICE']=0xc;export default RevisionHistoryService;