/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x1a0a85 from'./../messagescompressor.js';import _0x38f007 from'./messages/addsuggestionmessage.js';import _0x16c800 from'./responses/addsuggestionresponse.js';import _0x320deb from'./messages/getsuggestionmessage.js';import _0x197f32 from'./responses/getsuggestionresponse.js';import _0x29fe93 from'./messages/getallsuggestionsmessage.js';import _0x417397 from'./responses/getallsuggestionsresponse.js';import _0x2f2a7b from'./messages/updatesuggestionmessage.js';import _0x2f5865 from'./messages/connectmessage.js';import _0x48e346 from'./responses/connectresponse.js';import _0x54bbad from'../ckeditorcloudserviceserror.js';import _0xd4dbac,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x42ab3c from'../errors/ServiceNotConnectedError.js';import _0x5771e6 from'../ckeditorcloudservicesservererror.js';import _0x459f1b from'./messages/batchUpdateSuggestionsStateMessage.js';export const _SERVICE=0xa;class TrackChangesService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0x5592a8){super(),this['_documentId']=_0x5592a8,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x46315a){if(this['_isConnected'])return;if(_0x46315a['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x54bbad('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x46315a);const _0x168da1=new _0x2f5865(this['_documentId']);this['_wsGateway']=_0x46315a,this['stopListening'](_0x46315a,'change:state');const _0x5ac782=await _0x46315a['_sendRequest'](0xa,_0x2f5865['TYPE'],_0x1a0a85['encode'](_0x168da1)),_0x2d6e8f=_0x1a0a85['decode'](_0x5ac782,_0x48e346);return this['listenTo'](_0x46315a,'change:state',(_0x5c5119,_0x5eef4e,_0x529d8f)=>this['_onWsGatewayStateChange'](_0x529d8f),{'priority':_0xd4dbac['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x46315a,_0x2d6e8f['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x2d6e8f['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x2df596,_0x93918e,_0x153172,_0x55cbe4=null,_0x35ec08){const _0x459ccb=new _0x38f007(_0x2df596,this['_documentId'],_0x93918e,_0x153172,_0x55cbe4,_0x35ec08),_0x28165e=await this['_sendRequest'](_0x38f007['TYPE'],_0x459ccb);return _0x1a0a85['decode'](_0x28165e,_0x16c800);}async['get'](_0x490e52,_0x3cd4dc=0x1){const _0x49677f=new _0x320deb(_0x490e52,this['_documentId']);try{const _0x4b79d6=await this['_sendRequest'](_0x320deb['TYPE'],_0x49677f);return _0x1a0a85['decode'](_0x4b79d6,_0x197f32);}catch(_0x5d2769){if('CKEditorCloudServicesServerError'===_0x5d2769['name']&&'404'===_0x5d2769['code']&&_0x3cd4dc<0x5)return await(_0x53b06b=0x64*_0x3cd4dc,new Promise(_0x3018de=>{setTimeout(_0x3018de,_0x53b06b);})),this['get'](_0x490e52,_0x3cd4dc+0x1);if('CKEditorCloudServicesServerError'===_0x5d2769['name'])throw _0x5d2769;throw _0x5771e6['fromPublicError'](_0x5d2769);}var _0x53b06b;}async['getAll'](){const _0x3f086a=new _0x29fe93(this['_documentId']),_0x13179f=await this['_sendRequest'](_0x29fe93['TYPE'],_0x3f086a),{suggestions:_0x4510de}=_0x1a0a85['decode'](_0x13179f,_0x417397);return _0x4510de;}async['update'](_0xcb6e37,_0x219027={}){const {hasComments:_0x5368d1,state:_0x436cfa,attributes:_0x3cfacd}=_0x219027,_0x46c080=void 0x0!==_0x5368d1,_0x549fe9=new _0x2f2a7b(_0xcb6e37,this['_documentId'],_0x5368d1,_0x46c080,_0x436cfa,_0x3cfacd);await this['_sendRequest'](_0x2f2a7b['TYPE'],_0x549fe9);}async['batchUpdateState'](_0xafd7fe){const _0x3f1b0c=new _0x459f1b(_0xafd7fe['ids'],this['_documentId'],_0xafd7fe['state']);await this['_sendRequest'](_0x459f1b['TYPE'],_0x3f1b0c);}['_connectToChannel'](_0x428b33,_0x357ed8){this['_channel']=_0x428b33['_getChannel'](TrackChangesService['_SERVICE'],_0x357ed8),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x2f2a7b['TYPE']),(_0x350dc7,_0x5608a8)=>{const _0x310da4=_0x1a0a85['decode'](_0x5608a8,_0x2f2a7b);this['fire']('suggestionUpdated',_0x310da4);});}['_onWsGatewayStateChange'](_0x416f35){_0x416f35===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x2683d,_0x2c767a){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x42ab3c('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](0xa,_0x2683d,_0x1a0a85['encode'](_0x2c767a));}}TrackChangesService['_SERVICE']=0xa;export default TrackChangesService;