/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x2a9b01}from'ckeditor5/src/core.js';import{CKEditorError as _0x4985db}from'ckeditor5/src/utils.js';import _0xd2f836 from'./paginationlookup.js';import _0x1feb2b from'./paginationrenderer.js';import'../theme/pagination.css';export default class s extends _0x2a9b01{static get['pluginName'](){return'PaginationEditing';}static get['requires'](){return[_0xd2f836,_0x1feb2b];}['init'](){this['set']({'pageNumber':0x1,'totalPages':0x1});const _0xae1285=this['editor']['plugins']['get']('Pagination'),_0x832697=this['editor']['plugins']['get'](_0xd2f836),_0x113f80=this['editor']['plugins']['get'](_0x1feb2b);this['bind']('isEnabled')['to'](_0xae1285),this['_setUpDataDowncastConversion'](),this['bind']('pageNumber')['to'](_0x113f80),this['listenTo'](_0x832697,'change:pageBreaks',(_0x417d57,_0x220328,_0x44461e,_0x282275)=>{this['totalPages']=_0x44461e['length'],this['_updatePageBreakMarkers'](_0x44461e,_0x282275);}),this['_setupKeystrokes']();const _0x1a3a76=this['editor'];this['licenseKey']=_0x1a3a76['config']['get']('licenseKey'),this['_licenseKeyCheckInterval']=setInterval(()=>{let _0x5d73f8;for(const _0xa9c802 in _0x1a3a76){const _0x1e0c47=_0xa9c802,_0x2fdbe6=_0x1a3a76[_0x1e0c47];if('paginationLicenseKeyTrial'===_0x2fdbe6||'paginationLicenseKeyInvalid'===_0x2fdbe6||'paginationLicenseKeyValid'===_0x2fdbe6||'paginationLicenseKeyTrialLimit:operations'===_0x2fdbe6){delete _0x1a3a76[_0x1e0c47],_0x5d73f8=_0x2fdbe6;break;}}if('paginationLicenseKeyInvalid'===_0x5d73f8)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x4985db('pagination-invalid-license-key',null);if('paginationLicenseKeyTrial'===_0x5d73f8&&console['info']('You\x20are\x20using\x20the\x20trial\x20version\x20of\x20CKEditor\x205\x20pagination\x20plugin\x20with\x20limited\x20usage.\x20Make\x20sure\x20you\x20will\x20not\x20use\x20it\x20in\x20the\x20production\x20environment.'),'paginationLicenseKeyTrialLimit:operations'===_0x5d73f8)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x4985db('pagination-trial-license-key-reached-limit-changes',null);'paginationLicenseKeyValid'===_0x5d73f8&&clearInterval(this['_licenseKeyCheckInterval']);},0x3e8);}['destroy'](){clearInterval(this['_licenseKeyCheckInterval']);}['scrollToPage'](_0x285f28){if(!this['isEnabled'])return;this['editor']['plugins']['get'](_0x1feb2b)['scrollToPage'](this['_validatePageNumber'](_0x285f28));}['moveSelectionToPage'](_0x47dffa){if(!this['isEnabled'])return;const _0x2860bb=this['editor'],_0x479e59=this['editor']['plugins']['get'](_0xd2f836)['pageBreaks'][_0x47dffa-0x1];_0x479e59&&_0x2860bb['model']['change'](_0x4cd4fa=>{switch(_0x479e59['type']){case'manual':{const _0x535ff5=_0x2860bb['model']['schema']['getNearestSelectionRange'](_0x479e59['modelRange']['end'],'forward');_0x4cd4fa['setSelection'](_0x535ff5);break;}case'element':{const _0x333e17=_0x2860bb['model']['schema']['getNearestSelectionRange'](_0x479e59['modelRange']['start'],'forward');_0x4cd4fa['setSelection'](_0x333e17);break;}case'text':{const _0x3fb4cd=_0x479e59['modelRange']['start'];if('\x20'===_0x3fb4cd['textNode']['data'][_0x3fb4cd['offset']]){const _0xe4958=_0x4cd4fa['createPositionAt'](_0x3fb4cd['parent'],_0x3fb4cd['offset']+0x1);_0x4cd4fa['setSelection'](_0xe4958);}else _0x4cd4fa['setSelection'](_0x479e59['modelRange']);}}_0x2860bb['editing']['view']['focus']();});}['goToNextPage'](){const _0xe4e1a2=this['_validatePageNumber'](this['pageNumber']+0x1);this['moveSelectionToPage'](_0xe4e1a2),this['scrollToPage'](_0xe4e1a2);}['goToPreviousPage'](){const _0x29bc4f=this['_validatePageNumber'](this['pageNumber']-0x1);this['moveSelectionToPage'](_0x29bc4f),this['scrollToPage'](_0x29bc4f);}['_updatePageBreakMarkers'](_0x49d748,_0x16a67d){const _0x22c735=this['editor']['model'];this['isEnabled']&&_0x22c735['change'](_0x1fb4dd=>{for(let _0x385d0f=0x1;_0x385d0f<_0x49d748['length'];_0x385d0f++){const _0x3c5ba9=_0x49d748[_0x385d0f]['modelRange'],_0x4d49db='pagination:'+(_0x385d0f+0x1);_0x22c735['markers']['has'](_0x4d49db)?_0x1fb4dd['updateMarker'](_0x4d49db,{'range':_0x3c5ba9}):_0x1fb4dd['addMarker'](_0x4d49db,{'range':_0x3c5ba9,'usingOperation':!0x1,'affectsData':!0x0});}for(let _0x397e20=_0x49d748['length'];_0x397e20<_0x16a67d['length'];_0x397e20++){const _0x10d56b='pagination:'+(_0x397e20+0x1);_0x22c735['markers']['has'](_0x10d56b)&&_0x1fb4dd['removeMarker'](_0x10d56b);}});}['_setUpDataDowncastConversion'](){const _0x53ee54='pagination';this['editor']['conversion']['for']('dataDowncast')['add'](_0x4c2c2e=>{_0x4c2c2e['on']('addMarker:'+_0x53ee54,(_0x3cebbc,{markerRange:_0x10888d,markerName:_0x5c7150},_0x4ccbaa)=>{if(!_0x4ccbaa['options']['pagination'])return;if(!_0x4ccbaa['consumable']['consume'](_0x10888d,_0x3cebbc['name']))return;const _0x13ba24=_0x10888d['getContainedElement']();let _0x273678=_0x13ba24?_0x4ccbaa['mapper']['toViewElement'](_0x13ba24):null;if(!_0x273678){const _0x20dabe=_0x10888d['start'];if(_0x4ccbaa['schema']['checkChild'](_0x20dabe,'$text')){const _0xc747c1=_0x4ccbaa['mapper']['toViewPosition'](_0x20dabe);_0x273678=_0x4ccbaa['writer']['createContainerElement']('span'),_0x273678['getFillerOffset']=()=>null,_0x4ccbaa['writer']['insert'](_0xc747c1,_0x273678);}else{const _0x4e0733=_0x20dabe['nodeAfter'];_0x273678=_0x4ccbaa['mapper']['toViewElement'](_0x4e0733);}}for(;_0x273678['parent']!==_0x273678['root']&&0x0===_0x273678['index'];)_0x273678=_0x273678['parent'];const _0x1b182b=_0x5c7150['substring'](0xb);_0x4ccbaa['writer']['setStyle']('page-break-before','always',_0x273678),_0x4ccbaa['writer']['setAttribute']('data-pagination-page',_0x1b182b,_0x273678),_0x4ccbaa['mapper']['bindElementToMarker'](_0x273678,_0x5c7150),_0x3cebbc['stop']();});});}['_setupKeystrokes'](){const _0x1fa65c=this['editor'],t=_0x1fa65c['locale']['t'];_0x1fa65c['keystrokes']['set']('Shift+Pageup',(_0x5e49fe,_0x3ff9ea)=>{this['goToPreviousPage'](),_0x3ff9ea();}),_0x1fa65c['keystrokes']['set']('Shift+Pagedown',(_0xc5e1bc,_0x54d0ae)=>{this['goToNextPage'](),_0x54d0ae();}),_0x1fa65c['accessibility']['addKeystrokeInfoGroup']({'id':'pagination','label':t('Keystrokes\x20for\x20navigating\x20through\x20documents'),'keystrokes':[{'label':t('Go\x20to\x20the\x20previous\x20page\x20(also\x20move\x20selection)'),'keystroke':'Shift+Pageup','mayRequireFn':!0x0},{'label':t('Go\x20to\x20the\x20next\x20page\x20(also\x20move\x20selection)'),'keystroke':'Shift+Pagedown','mayRequireFn':!0x0}]});}['_validatePageNumber'](_0x4575c9){return _0x4575c9<0x1&&(_0x4575c9=0x1),_0x4575c9>this['totalPages']&&(_0x4575c9=this['totalPages']),_0x4575c9;}}